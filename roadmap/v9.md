# v9 — QA Gate + 自動測試（長期營運把關）

## 目標
建立「自我測試把關」與「發佈前 QA Gate」，讓 Rocket Screener 進入可長期營運狀態：
- 任何內容錯誤（缺 link、缺 disclaimer、數字缺來源、slug 重複）都會被擋下
- 生成流程可 dry-run，並產出 QA 報告（JSON/Markdown）

---

## 範圍（Scope）
### 會做：QA Gate（hard fail）
- 文章 1：
  - Top events 數量 5–8
  - 每則事件至少 1 個 source link（URL 格式正確）
  - 必有市場快照段落
- 文章 2：
  - 必含估值章節
  - 必含 Bull/Base/Bear（至少中期）
  - 若估值圖缺失，需有降級文字表格（不能空）
- 文章 3：
  - 必含代表股表格（至少 3 檔）
  - 必含展望情境（Base/Bull/Bear 或 Base+上/下行）
- 全部文章：
  - 必含免責聲明（固定文字）
  - slug、title、date 一致
- 發佈：
  - idempotent（查 slug 後 update/create）
  - 文章 1 才寄信；文章 2/3 不寄

### 會做：自動測試（最低集合）
- unit tests：scoring/dedupe/valuation
- snapshot tests：文章輸出包含固定 headings（避免模板被破壞）
- integration smoke：dry-run 產出 3 篇 + QA report

---

## 交付物（Deliverables）
- `qa/gates.py`（集中管理）
- `qa/report.py`（輸出可讀報告）
- `tests/`（pytest）
- `SELF_TESTS.md` 更新：如何跑測試、如何解讀報告

---

## 驗收標準（Definition of Done）
- [ ] QA gate 失敗時不發佈、不寄信，且輸出明確錯誤（可讀）
- [ ] 最低測試集可在 CI / 本機跑通
- [ ] dry-run 可產出 3 篇文章 + QA report

---

## 下一版（v10）會加什麼
- 監控、告警、成本控管、Prompt 版本化、未來會員牆切換開關

