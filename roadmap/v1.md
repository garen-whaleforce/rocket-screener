# v1 — 工程骨架 + Ghost 發佈跑通（可重跑）

## 目標
建立 Rocket Screener 的最小可行工程骨架：**能在本機/伺服器上跑一次完整流程**，並能把 3 篇文章以「草稿或已發佈」形式送到 Ghost（先用假資料/樣板也可以），確保：
- Ghost 連線、認證、建立文章、設定 feature image（可選）可行
- 「只寄文章 1」的寄信策略可行（用 `newsletter` 參數）
- 同一天重跑不會重複發文/重複寄信（idempotent）

> v1 不追求內容品質；追求「管線跑通 + 可重跑 + 可觀測」。

---

## 範圍（Scope）
### 會做
- 建 repo 目錄結構（ingest/normalize/features/evidence/llm/publish/ops）
- `.env` 與 config 管理（不把 key 寫進 repo）
- Ghost Admin API client（最少支援）
  - upload image（先留 stub 也可）
  - create/update post
  - publish post
- 文章模板（Markdown）放入 `templates/`
- CLI 入口（建議）：`python -m rocketscreener.run --date YYYY-MM-DD --dry-run`
- 日誌（logging）與 error handling 基礎

### 不做
- 真正的 FMP/SEC/transcript ingestion（下一版）
- 真正的選題與估值（下一版）
- 中午補強（明確不做）

---

## 交付物（Deliverables）
1) `app/` 目錄骨架（可 import、可跑）
2) `templates/`：三篇文章模板（先用 placeholder）
3) `publish/ghost_client.py`：可在 Ghost 建立一篇文章（至少）
4) `ops/runbook.md`：如何在伺服器上跑（手動）

---

## 建議檔案結構（可按你們習慣微調）
```
app/
  run.py
  config.py
  publish/ghost_client.py
  publish/publish_posts.py
  templates/
    article1.md
    article2.md
    article3.md
    newsletter_snippet.md
  ops/
    runbook.md
```

---

## 實作要點（Implementation Notes）
### 1) Idempotency（非常重要）
- 每篇文章 slug 建議含日期，例如：
  - `daily-brief-YYYYMMDD`
  - `equity-deep-dive-YYYYMMDD-{ticker}`
  - `theme-trend-YYYYMMDD-{theme}`
- 發佈前先查是否已有同 slug 的 post：
  - 有 → update
  - 無 → create

### 2) 寄信策略
- 只在發佈文章 1 時帶 `newsletter=<slug>` 與 `email_segment=status:free`
- 文章 2、3 一律不帶 `newsletter` 參數（避免誤寄）

### 3) 安全
- `.env`：`GHOST_ADMIN_API_URL`, `GHOST_ADMIN_API_KEY`, `NEWSLETTER_SLUG`, `EMAIL_SEGMENT`
- 日誌禁止輸出 key

---

## 驗收標準（Definition of Done）
- [ ] `--dry-run` 可輸出三篇 Markdown 到 `out/`（不發佈）
- [ ] `--publish` 可在 Ghost 建立/更新 3 篇文章（內容可先是 placeholder）
- [ ] 文章 1 發佈會寄信；文章 2/3 不寄
- [ ] 同日重跑不會生成重複文章或重複寄信（以 slug 驗證）
- [ ] 有基本 log：開始/結束、每步耗時、錯誤堆疊

---

## 下一版（v2）會加什麼
- 串 FMP：市場快照 + 新聞抓取 + 文章 1 真內容生成

